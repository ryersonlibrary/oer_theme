{"version":3,"sources":["../assets/scripts/find.js"],"names":["$","opentextbookxhrpaginate","v","offset","defaultitemstodisplay","opentextbookdspacexhr","jQuery","html","opentextbookxhr","abort","querydata","each","searchfacets","k","dspacefriendlyterm","searchterm","val","searchdata","toString","getJSON","data","empty","text","length","searchlimitations","searchlimitationsparams","replace","author","subjects","metadata","key","value","push","subj","join","append","uuid","name","css","opentextbooksetupdiscovery","removeClass","subjectstoshow","children","hide","slice","show","click","done","this","attr","addClass","subject","type","date","peerreview","level","language","rights","source","keypress","e","which"],"mappings":"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","file":"find.js","sourcesContent":["/* jshint latedef:nofunc */\n//needed for function hoisting for build\n\n(function($) {\n  \n\t/***OpenTextBook***/\n\tvar opentextbookxhr = null;\n\tvar searchfacets={\"subject\":\"\",\"type\":\"\",\"date\":\"3months\",\"peerreview\":\"reviewed\",\"level\":\"postsecondary\",\"language\":\"\",\"rights\":\"\",\"source\":\"\"};\n\tvar searchterm='';\n\tvar offset=0;\n\tvar defaultitemstodisplay=10;\n\t\n\tfunction opentextbookxhrpaginate(v){\n\t\toffset=(v*defaultitemstodisplay)-defaultitemstodisplay; //subtract default to handle offset of 0*10 and pagination; i.e. offset is *start* of page, not end (page 1 contains items 0-9; page 2, 10-19)\n\t\topentextbookdspacexhr();\n\t}\n\t\n\tfunction opentextbookdspacexhr(){\n\t\tjQuery('#results-list').html('<img class=\"ajaxloader\" src=\"/wp-content/themes/opentextbook/dist/images/ajax-loader.gif\">');\n\t\t/* if there is a previous ajax request, then we abort it and then set xhr to null */\n\t\tif( opentextbookxhr != null ) {\n\t\t\topentextbookxhr.abort();\n\t\t\topentextbookxhr = null;\n\t\t}\n\t\t/**build querydata**/\n\t\tvar querydata='';\n\t\t$.each(searchfacets,function(k,v){\n\t\t\tvar dspacefriendlyterm=k;\n\t\t\tswitch(k){\n\t\t\t\tcase \"date\":\n\t\t\t\t\tdspacefriendlyterm=k+\".issued\";\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tquerydata=querydata+\"query_field[]=dc.\"+dspacefriendlyterm+\"&query_op[]=contains&query_val[]=\"+v+\"&\";\n\t\t});\n\t\tsearchterm=jQuery('#discovery-keyword-term').val();\n\t\tvar searchdata=querydata+\"query_field[]=*&query_op[]=contains&query_val[]=\"+searchterm+\"&limit=\"+defaultitemstodisplay.toString()+\"&offset=\"+offset.toString();\n\t\t/* and now we can safely make another ajax request since the previous one is aborted */\n\t\topentextbookxhr = jQuery.getJSON( \"/10_items.json\", searchdata, function(data){\n\t\t\tjQuery('#results-list,.searchterm').empty();\n\t\t\tjQuery('#results-counter-totalresults').text(data.length);\n\t\t\tvar searchlimitations='';\n\t\t\t//maintain array order! it is syntactic. date is handled afterwards for similar reasons.\n\t\t\tvar searchlimitationsparams=[\"peerreview\",\"source\",\"rights\",\"language\",\"level\",\"type\"];\n\t\t\t\n\t\t\t/*jshint -W069 */\n\t\t\t/*Disable Warning Justification:\n\t\t\t    Using bracket notation to facilitate querystring params for DSpace API which use periods, e.g. dc.contributor.author */\n\t\t\t$.each(searchlimitationsparams,function(k,v){\n\t\t\t\tif(searchfacets[v]!==''){\n\t\t\t\t\tsearchlimitations=searchlimitations+' '+$('[data-term=\"'+searchfacets[v]+'\"]').text();\n\t\t\t\t}\n\t\t\t});\n\t\t\tjQuery('#search-limitations').text(searchlimitations.replace(/Items Only/gi, \"\"));\n\t\t\tif(searchfacets[\"subject\"]!==''){\n\t\t\t\tjQuery('#search-subject').html(' <span class=\"notsearchterm\">in</span> '+$('[data-term=\"'+searchfacets[\"subject\"]+'\"]').text());\n\t\t\t}\n\t\t\tif(searchterm!==''){\n\t\t\t\tjQuery('#search-keyword').html(' <span class=\"notsearchterm\">with the keyword \"</span>'+searchterm+'<span class=\"notsearchterm\">\"</span>');\n\t\t\t}\n\t\t\tif(searchfacets[\"date\"]!==''){\n\t\t\t\tjQuery('#search-created').html(' <span class=\"notsearchterm\">created within the</span> '+$('[data-term=\"'+searchfacets[\"date\"]+'\"]').text());\n\t\t\t}\n\t\t\t/*jshint +W069 */\n\t\t\t\n\t\t\t/*** NEED PAGINATION in JSON\n\t\t\tjQuery('#results-counter-totalpages').text(data.totalpages);\n\t\t\tjQuery('#results-counter-thispage').text(data.thispage);\n\t\t\tjQuery.each(data.totalpages,function(k,v)){\n\t\t\t\tjQuery('#results-pagecounter-pages').append('<span class=\"resultspage\" id=\"resultspage-'+k+'\">'+k+'</span>');\n\t\t\t\tjQuery('#resultspage-'+k).click(function(){\n\t\t\t\t\topentextbookxhrpaginate(k);\n\t\t\t\t});\n\t\t\t});\n\t\t\t***/\n\t\t\tjQuery.each(data,function(k,v){\n\t\t\t\tvar author='';\n\t\t\t\tvar subjects=[];\n\t\t\t\tjQuery.each(v.metadata,function(k,v){\n\t\t\t\t\tif(v.key==='dc.contributor.author'){\n\t\t\t\t\t\tauthor=v.value;\n\t\t\t\t\t}\n\t\t\t\t\tif(v.key==='dc.subject'){\n\t\t\t\t\t\tsubjects.push(v.value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar subj=subjects.join(\",\");\n\t\t\t\tjQuery('#results-list').append('<div class=\"result-item col-lg-3 col-md-4\"><span id=\"'+v.uuid+'\" class=\"textbook\"><span id=\"'+v.uuid+'-cover\"class=\"textbook-cover\"></span><p class=\"textbook-header\">'+subj+'</p><h4 class=\"textbook-title\">'+v.name+'</h4><p class=\"textbook-authors\">'+author+'</p><p class=\"textbook-footer\">&gt;&nbsp;&nbsp;<a href=\"preview/?id='+v.uuid+'\">About this book</a></p>');\n\t\t\t\tjQuery('#'+v.uuid+'-cover').css(\"backgroundImage\",\"url('/wp-content/themes/opentextbook/dist/images/ryerson_stock_bg.jpg')\");\n\t\t\t});\n\t\t\tjQuery('#results-list').append('<div class=\"result-item create-new-item col-lg-3 col-md-4\"><span id=\"new-textbook\" class=\"textbook\"><span class=\"textbook-cover\"></span><p class=\"textbook-header\">&nbsp;</p><h4 class=\"textbook-title\">Create your own textbook</h4><p class=\"textbook-authors\">Add a text to this (or any) topic.</p><p class=\"textbook-footer\"><input type=\"button\" value=\"Start Authoring\" class=\"btn btn-secondary\"></p></span></div>');\n\t\t});\n\t}\n\t\n\t/**set up discovery ui facets**/\n\tfunction opentextbooksetupdiscovery(){\n\t\toffset=0; //reset offset\n\t\t$('li').removeClass('selectedfacet');\n\t\tjQuery.getJSON( \"/subjects.json\", function(data){\n\t\t\t$.each(data.subjects,function(k,v){\n\t\t\t\tjQuery('#discovery-ui-subject').append('<li data-term=\"'+v+'\" class=\"subjectfacet\">'+v+'</li>');\n\t\t\t});\n\t\t\tvar subjectstoshow=5;\n\t\t\tjQuery('#discovery-ui-subject').children('li').hide();\n\t\t\tjQuery('#discovery-ui-subject > li').slice(0,subjectstoshow).show();\n\t\t\t$('#discovery-moresubjects').click(function() {\n\t\t\t\t$('#discovery-ui-subject > li:hidden').slice(0,subjectstoshow).show();\n\t\t\t\tif($('#discovery-ui-subject > li:hidden').length === 0){\n\t\t\t\t\t$('#discovery-moresubjects').hide();\n\t\t\t\t}\n\t\t\t});\n\t\t}).done(function(){\n\t\t\t$.each(searchfacets,function(k,v){\n\t\t\t\t$('#discovery-ui-'+k).children('li').each(function(){\n\t\t\t\t\tif($(this).attr('data-term')===v){\n\t\t\t\t\t\t$(this).addClass('selectedfacet');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t$('#discovery-ui-'+k).children('li').click(function(){\n\t\t\t\t\toffset=0; //changing search params, reset offset for pagination\n\t\t\t\t\tsearchfacets[k]=$(this).attr('data-term');\n\t\t\t\t\t$('#discovery-ui-'+k).children('li').removeClass('selectedfacet');\n\t\t\t\t\t$(this).addClass('selectedfacet');\n\t\t\t\t});\n\t\t\t});\n\t\t\t//auto run a search to populate results.\n\t\t\topentextbookdspacexhr();\n\t\t});\n\t}\n\t\n\topentextbooksetupdiscovery();\n\t\n\t//test purposes only!\n\tjQuery('#resultspage-2').click(function(){\n\t\topentextbookxhrpaginate(2);\n\t});\n\t\n\tjQuery('#discovery-submit-btn').click(function(){\n\t\topentextbookdspacexhr();\n\t});\n\tjQuery('#discovery-reset-btn').click(function(){\n\t\tsearchfacets={\"subject\":\"\",\"type\":\"\",\"date\":\"3months\",\"peerreview\":\"reviewed\",\"level\":\"postsecondary\",\"language\":\"\",\"rights\":\"\",\"source\":\"\"};\n\t\topentextbooksetupdiscovery();\n\t});\n\t\n\t/**make term input fire**/\n\t$('#discovery-keyword-term').keypress(function(e) {\n\t\toffset=0; //reset offset anytime typing occurs in keyword-term\n\t    if(e.which === 13) {\n\t    \topentextbookdspacexhr();\n\t    }\n\t});\n})(jQuery);\n"],"sourceRoot":"assets/scripts/"}