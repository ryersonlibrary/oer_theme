!function(e){function t(e){i=e*n-n,s()}function s(){jQuery("#results-list").html('<img class="ajaxloader" src="/wp-content/themes/opentextbook/dist/images/ajax-loader.gif">'),null!=c&&(c.abort(),c=null);var t="";e.each(a,function(e,s){var r=e;switch(e){case"date":r=e+".issued"}t=t+"query_field[]=dc."+r+"&query_op[]=contains&query_val[]="+s+"&"}),o=jQuery("#discovery-keyword-term").val();var s=t+"query_field[]=*&query_op[]=contains&query_val[]="+o+"&limit="+n.toString()+"&offset="+i.toString();c=jQuery.getJSON("/10_items.json",s,function(t){jQuery("#results-list,.searchterm").empty(),jQuery("#results-counter-totalresults").text(t.length);var s="",r=["peerreview","source","rights","language","level","type"];e.each(r,function(t,r){""!==a[r]&&(s=s+" "+e('[data-term="'+a[r]+'"]').text())}),jQuery("#search-limitations").text(s.replace(/Items Only/gi,"")),""!==a.subject&&jQuery("#search-subject").html(' <span class="notsearchterm">in</span> '+e('[data-term="'+a.subject+'"]').text()),""!==o&&jQuery("#search-keyword").html(' <span class="notsearchterm">with the keyword "</span>'+o+'<span class="notsearchterm">"</span>'),""!==a.date&&jQuery("#search-created").html(' <span class="notsearchterm">created within the</span> '+e('[data-term="'+a.date+'"]').text()),jQuery.each(t,function(e,t){var s="",r=[];jQuery.each(t.metadata,function(e,t){"dc.contributor.author"===t.key&&(s=t.value),"dc.subject"===t.key&&r.push(t.value)});var c=r.join(",");jQuery("#results-list").append('<div class="result-item col-lg-3 col-md-4"><span id="'+t.uuid+'" class="textbook"><span id="'+t.uuid+'-cover"class="textbook-cover"></span><p class="textbook-header">'+c+'</p><h4 class="textbook-title">'+t.name+'</h4><p class="textbook-authors">'+s+'</p><p class="textbook-footer">&gt;&nbsp;&nbsp;<a href="preview/?id='+t.uuid+'">About this book</a></p>'),jQuery("#"+t.uuid+"-cover").css("backgroundImage","url('/wp-content/themes/opentextbook/dist/images/ryerson_stock_bg.jpg')")}),jQuery("#results-list").append('<div class="result-item create-new-item col-lg-3 col-md-4"><span id="new-textbook" class="textbook"><span class="textbook-cover"></span><p class="textbook-header">&nbsp;</p><h4 class="textbook-title">Create your own textbook</h4><p class="textbook-authors">Add a text to this (or any) topic.</p><p class="textbook-footer"><input type="button" value="Start Authoring" class="btn btn-secondary"></p></span></div>')})}function r(){i=0,e("li").removeClass("selectedfacet"),jQuery.getJSON("/subjects.json",function(t){e.each(t.subjects,function(e,t){jQuery("#discovery-ui-subject").append('<li data-term="'+t+'" class="subjectfacet">'+t+"</li>")});var s=5;jQuery("#discovery-ui-subject").children("li").hide(),jQuery("#discovery-ui-subject > li").slice(0,s).show(),e("#discovery-moresubjects").click(function(){e("#discovery-ui-subject > li:hidden").slice(0,s).show(),0===e("#discovery-ui-subject > li:hidden").length&&e("#discovery-moresubjects").hide()})}).done(function(){e.each(a,function(t,s){e("#discovery-ui-"+t).children("li").each(function(){e(this).attr("data-term")===s&&e(this).addClass("selectedfacet")}),e("#discovery-ui-"+t).children("li").click(function(){i=0,a[t]=e(this).attr("data-term"),e("#discovery-ui-"+t).children("li").removeClass("selectedfacet"),e(this).addClass("selectedfacet")})}),s()})}var c=null,a={subject:"",type:"",date:"3months",peerreview:"reviewed",level:"postsecondary",language:"",rights:"",source:""},o="",i=0,n=10;r(),jQuery("#resultspage-2").click(function(){t(2)}),jQuery("#discovery-submit-btn").click(function(){s()}),jQuery("#discovery-reset-btn").click(function(){a={subject:"",type:"",date:"3months",peerreview:"reviewed",level:"postsecondary",language:"",rights:"",source:""},r()}),e("#discovery-keyword-term").keypress(function(e){i=0,13===e.which&&s()})}(jQuery);