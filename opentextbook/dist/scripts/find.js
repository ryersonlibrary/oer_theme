"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}(function($){var DiscoveryController=function(){function DiscoveryController(discoveryObj){_classCallCheck(this,DiscoveryController);this.discoveryObj=discoveryObj;this.controller=null;this.facets=null;this.queue=[]}_createClass(DiscoveryController,[{key:"enqueue",value:function enqueue(){}},{key:"submit",value:function submit(){}}]);return DiscoveryController}();var DiscoveryView=function(){function DiscoveryView(){_classCallCheck(this,DiscoveryView)}_createClass(DiscoveryView,[{key:"contructor",value:function contructor(){}}]);return DiscoveryView}();var HTMLUIController=function(_DiscoveryController){_inherits(HTMLUIController,_DiscoveryController);function HTMLUIController(discoveryObj){_classCallCheck(this,HTMLUIController);var _this=_possibleConstructorReturn(this,(HTMLUIController.__proto__||Object.getPrototypeOf(HTMLUIController)).call(this,discoveryObj));_this.controller=$("[data-widget='discovery-controller']");_this.facets=_this.controller.find("[data-facet]");_this.initUI();return _this}_createClass(HTMLUIController,[{key:"initUI",value:function initUI(){var self=this;this.facets.each(function(){var facet=$(this);if(_typeof(facet.data("ui-type"))===undefined){return}var initfnc="init"+facet.data("ui-type").ucfirst();if(typeof self[initfnc]!=="function"){return}self[initfnc](facet)})}},{key:"initList",value:function initList(facet){var self=this;facet.find("[data-user-input-wrapper]").find("li").each(function(){$(this).bind("click",function(event){event.preventDefault();var item=$(this);item.toggleClass("selected");if(item.data("value")==="*"){facet.removeAttr("data-enqueue");item.siblings("li").removeAttr("data-selected")}else{facet[0].setAttribute("data-enqueue","");item[0].setAttribute("data-selected","")}self.submit()})})}},{key:"initTextfield",value:function initTextfield(facet){var self=this;facet.find("[data-user-input]").each(function(){$(this).bind("keypress",function(event){var input=$(this);if(input.val().length>2){facet[0].setAttribute("data-enqueue","");input[0].setAttribute("data-selected","");input.attr("data-value",input.val());self.submit()}else{facet.removeAttr("data-enqueue");input.removeAttr("data-selected")}}).bind("keypress",function(event){if((event.keyCode?event.keyCode:event.which)===13){self.submit();return false}else{return true}})})}},{key:"enqueue",value:function enqueue(){var self=this;this.queue=[];this.controller.find("[data-enqueue]").each(function(){var facet=$(this);var values=[];facet.find("[data-selected]").each(function(){self.queue.push({op:facet.data("op"),values:facet.data("param").replace("%%",$(this).attr("data-value")).split("|")})})})}},{key:"submit",value:function submit(){_get(HTMLUIController.prototype.__proto__||Object.getPrototypeOf(HTMLUIController.prototype),"submit",this).call(this);this.enqueue();this.discoveryObj.stateChange()}}]);return HTMLUIController}(DiscoveryController);var HTMLView=function(_DiscoveryView){_inherits(HTMLView,_DiscoveryView);function HTMLView(viewID){_classCallCheck(this,HTMLView);var _this2=_possibleConstructorReturn(this,(HTMLView.__proto__||Object.getPrototypeOf(HTMLView)).call(this));_this2.id=$(viewID);return _this2}return HTMLView}(DiscoveryView);var PaginatedHTMLView=function(_DiscoveryView2){_inherits(PaginatedHTMLView,_DiscoveryView2);function PaginatedHTMLView(){_classCallCheck(this,PaginatedHTMLView);return _possibleConstructorReturn(this,(PaginatedHTMLView.__proto__||Object.getPrototypeOf(PaginatedHTMLView)).call(this))}return PaginatedHTMLView}(DiscoveryView);var DiscoveryDataHandler=function(){function DiscoveryDataHandler(dbURI,dbmethod){_classCallCheck(this,DiscoveryDataHandler);this.dburl=dbmethod+"://"+dbURI;this.paths=this.build_paths();this.query={};this.XHROpts=this.resetXHROpts();this.results={}}_createClass(DiscoveryDataHandler,[{key:"resetQueryParameters",value:function resetQueryParameters(){this.query={}}},{key:"setQueryParameter",value:function setQueryParameter(parameter,value){var operator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"like";this.query[Parameter]=value;return this}},{key:"setSearchTerm",value:function setSearchTerm(term){var operator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"contains";return this}},{key:"setDateIssed",value:function setDateIssed(value){var operator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"<";return this}},{key:"setLimit",value:function setLimit(limit,offset){return this}},{key:"getQuery",value:function getQuery(){return this.query}},{key:"resetXHROpts",value:function resetXHROpts(){this.XHROpts={async:false,method:"GET",traditional:true,crossOrigin:true,error:this.xhrError,success:this.xhrResultsHandler}}},{key:"setXHROpt",value:function setXHROpt(opt,value){this.XHROpts[opt]=value;return this}},{key:"getXHROpts",value:function getXHROpts(){return this.XHROpts}},{key:"performQuery",value:function performQuery(){this.resetXHROpts();this.setXHROpt("url",this.makeURL(this.paths.query.filtered_items.path)).setXHROpt("method",this.paths.query.filtered_items.method).setXHROpt("data",this.query);this.retrieve();return this}},{key:"getResults",value:function getResults(){return this.results}},{key:"makeURL",value:function makeURL(path){return this.dburl+"/"+path}},{key:"retrieve",value:function retrieve(){var self=this;$.ajax($.extend(this.XHROpts,{success:[function(data){self.results=data},self.xhrResultsHandler]}))}},{key:"xhrError",value:function xhrError(xhr,ajaxOptions,thrownError){console.log("error");console.log(xhr);console.log(thrownError)}},{key:"xhrResultsHandler",value:function xhrResultsHandler(data,textStatus,jqXHR){}},{key:"build_paths",value:function build_paths(){return{items:{list:{method:"GET",path:"[path]"},item:{method:"GET",path:"[path]/%%"},item_metadata:{method:"GET",path:"[path]/%%/[key]"},find_by_metadata:{method:"POST",path:"[path]"}},query:{filtered_items:{method:"GET",path:"[path]"},filtered_collections:{method:"GET",path:"[path]"},collection:{method:"GET",path:"[path]/%%"}}}}}]);return DiscoveryDataHandler}();var DSpaceDataHandler=function(_DiscoveryDataHandler){_inherits(DSpaceDataHandler,_DiscoveryDataHandler);function DSpaceDataHandler(dbURI,dbmethod){_classCallCheck(this,DSpaceDataHandler);var _this4=_possibleConstructorReturn(this,(DSpaceDataHandler.__proto__||Object.getPrototypeOf(DSpaceDataHandler)).call(this,dbURI,dbmethod));_this4.query=[];_this4.expansion=[];_this4.filters=[];_this4.fields=[];return _this4}_createClass(DSpaceDataHandler,[{key:"resetQueryParameters",value:function resetQueryParameters(){this.query=[]}},{key:"setQueryParameter",value:function setQueryParameter(parameter,value){var operator=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"like";this.query.push({name:"query_field[]",value:parameter});this.query.push({name:"query_op[]",value:operator});this.query.push({name:"query_val[]",value:value});return this}},{key:"setSearchTerm",value:function setSearchTerm(value){var operator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"contains";this.setQueryParameter("*",value,operator);return this}},{key:"setAdditionalParameter",value:function setAdditionalParameter(parameter,value){this.query.push({name:parameter,value:value});return this}},{key:"setDateIssed",value:function setDateIssed(term){var operator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"<";return this}},{key:"setLimit",value:function setLimit(){var limit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;this.setAdditionalParameter("limit",limit).setAdditionalParameter("offset",offset);return this}},{key:"setCollection",value:function setCollection(collectionID){this.setAdditionalParameter("collSel[]",collectionID);return this}},{key:"expandQuery",value:function expandQuery(expansion){this.expansion.push(expansion);this.setAdditionalParameter("expand",this.expansion.join(","));return this}},{key:"filterQuery",value:function filterQuery(filter){this.filters.push(filter);this.setAdditionalParameter("expand",this.filters.join(","));return this}},{key:"includeMetaData",value:function includeMetaData(){this.expandQuery("metadata");return this}},{key:"includeBitstreams",value:function includeBitstreams(){this.expandQuery("bitstreams");return this}},{key:"build_paths",value:function build_paths(){return{items:{list:{method:"GET",path:"items"},item:{method:"GET",path:"items/%%"},item_metadata:{method:"GET",path:"items/%%/metadata"},item_bitstreams:{method:"GET",path:"items/%%/bitstreams"},find_by_metadata:{method:"POST",path:"items/find-by-metadata-field"}},query:{filtered_items:{method:"GET",path:"filtered-items"},filtered_collections:{method:"GET",path:"filtered-collections"},collection:{method:"GET",path:"filtered-collections/%%"}},bitstreams:{list:{method:"GET",path:"bitsreams"},item:{method:"GET",path:"bitstreams/{%%}"},item_policy:{method:"GET",path:"bitstreams/%%/policy"},content:{method:"GET",path:"bitstreams/%%/retrieve"}},schemas:{list:{method:"GET",path:"registries/schema"},item:{method:"GET",path:"registries/schema/%%"},field:{method:"GET",path:"registries/metadata-fields/%%"}}}}}]);return DSpaceDataHandler}(DiscoveryDataHandler);var Discovery=function(){function Discovery(){_classCallCheck(this,Discovery);this.dataOpQueue=[];this.results={}}_createClass(Discovery,[{key:"stateChange",value:function stateChange(){this.dataOpQueue=this.controller.queue;console.log("Operations Queue");console.log(this.dataOpQueue);this.retrieveData()}},{key:"resetDataParameters",value:function resetDataParameters(){this.data.resetQueryParameters()}},{key:"retrieveData",value:function retrieveData(){var self=this;self.resetDataParameters();this.dataOpQueue.forEach(function(item){self.data[item.op].apply(self.data,item.values)});self.results=self.data.performQuery().getResults();console.log("results");console.log(self.results)}}]);return Discovery}();var ECommonsOntarioDiscovery=function(_Discovery){_inherits(ECommonsOntarioDiscovery,_Discovery);function ECommonsOntarioDiscovery(vars){_classCallCheck(this,ECommonsOntarioDiscovery);var _this5=_possibleConstructorReturn(this,(ECommonsOntarioDiscovery.__proto__||Object.getPrototypeOf(ECommonsOntarioDiscovery)).call(this));_this5.controller=new HTMLUIController(_this5);_this5.view=new PaginatedHTMLView;_this5.data=new DSpaceDataHandler(vars.dbURI,vars.dbmethod);return _this5}_createClass(ECommonsOntarioDiscovery,[{key:"resetDataParameters",value:function resetDataParameters(){_get(ECommonsOntarioDiscovery.prototype.__proto__||Object.getPrototypeOf(ECommonsOntarioDiscovery.prototype),"resetDataParameters",this).call(this);this.data.includeMetaData()}}]);return ECommonsOntarioDiscovery}(Discovery);$(document).ready(function(){var discovery=new ECommonsOntarioDiscovery({dbURI:"books.spi.ryerson.ca/rest",dbmethod:"https"})})})(jQuery);String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
//# sourceMappingURL=find.js.map
