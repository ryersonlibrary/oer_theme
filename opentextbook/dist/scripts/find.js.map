{"version":3,"sources":["../assets/scripts/find.js"],"names":["$","DiscoveryController","DiscoveryView","HTMLUIController","controllerID","id","HTMLView","viewID","PaginatedHTMLView","DiscoveryDataHandler","dbURI","dbmethod","dburl","paths","build_paths","query","XHROpts","resetXHROpts","results","parameter","value","operator","Parameter","term","limit","offset","async","method","traditional","crossOrigin","error","xhrError","success","xhrResultsHandler","opt","setXHROpt","makeURL","filtered_items","path","retrieve","console","log","self","ajax","extend","data","xhr","ajaxOptions","thrownError","textStatus","jqXHR","items","list","item","item_metadata","find_by_metadata","filtered_collections","collection","DSpaceDataHandler","expansion","filters","fields","push","name","setQueryParameter","setAdditionalParameter","collectionID","join","filter","expandQuery","item_bitstreams","bitstreams","item_policy","content","schemas","field","Discovery","ECommonsOntarioDiscovery","vars","controller","view","document","ready","discovery","setSearchTerm","includeMetaData","performQuery","getResults","jQuery"],"mappings":"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","file":"find.js","sourcesContent":["/* jshint latedef:nofunc */\n//needed for function hoisting for build \n\n(function($) {\n    \n    class DiscoveryController {\n      constructor() {\n      \n      }  \n    }\n    \n    class DiscoveryView {\n      contructor() {\n        \n      }\n    }\n        \n    class HTMLUIController extends DiscoveryController {\n      constructor(controllerID) {\n        super();\n        this.id = $(controllerID);\n        \n      }\n    }\n    \n    class HTMLView extends DiscoveryView {\n      constructor(viewID) {\n        super();\n        this.id = $(viewID);\n        \n      }\n    }\n    \n    class PaginatedHTMLView extends DiscoveryView {\n      constructor() {\n        super();\n        \n      }\n    }\n    \n    /* !DATA HANDLER */\n    \n    class DiscoveryDataHandler {\n      constructor(dbURI, dbmethod) {\n        this.dburl = dbmethod + '://' + dbURI;\n        this.paths = this.build_paths();\n        this.query = {};\n        this.XHROpts = this.resetXHROpts();\n        this.results = {};\n                \n      }\n      \n      resetQueryParameters() {\n        this.query = {};\n      }\n  \n      // Placeholder. Will be particualar to database implementation. \n      \n      setQueryParameter(parameter,value,operator='like') {\n        this.query[Parameter] = value;\n        return this;  \n      }\n      \n      // Placeholder. Will be particular to database implementation\n      \n      setSearchTerm(term,operator='contains') {\n        return this;\n      }\n      \n      // Placeholder. Will be particualar to database implementation. \n      \n      setLimit(limit,offset) {\n        return this;\n      }      \n      \n      // A wrapper for the query Parameter\n      \n      getQuery() {\n        return this.query;\n      }\n      \n      // Sets default options for the AJAX call.\n      \n      resetXHROpts() {\n        this.XHROpts = {\n          async: false,\n          method: \"GET\", // default\n          traditional: true,\n          crossOrigin: true,\n          error: this.xhrError,\n          success: this.xhrResultsHandler\n        };\n      }\n      \n      // Set AJAX option as per http://api.jquery.com/jquery.ajax/\n      \n      setXHROpt(opt,value) {\n        this.XHROpts[opt] = value;\n        return this;\n      }\n      \n      // Wrapper that returns AJAX options\n      \n      getXHROpts() {\n        return this.XHROpts;\n      }\n      \n      // Performs filtered query\n      \n      performQuery() {\n        this.resetXHROpts();\n        this\n          .setXHROpt('url',this.makeURL(this.paths.query.filtered_items.path))\n          .setXHROpt('method',this.paths.query.filtered_items.method)\n          .setXHROpt('data',this.query);  \n        this.retrieve(); \n        return this;     \n      }\n      \n      getResults() {\n        console.log('get results');\n        console.log(this.results);\n        return this.results;\n      }\n      \n      makeURL(path) {\n        return this.dburl + \"/\" + path;\n      }\n      \n      /* ! -- AJAX call */\n      \n      /*\n        A number of things are going on here. The data results need to be scoped to the object instance so the success\n        a function expression was needed. The $.extend method allows us to do this and retain our this.XHROpts property.\n        The success parameter is passed an array, which calls a second method for post-processing.\n      */ \n                \n        \n      retrieve() {\n        var self = this;\n        $.ajax($.extend(this.XHROpts,{success: [function(data) { self.results = data; },self.xhrResultsHandler]}));\n      }\n      \n      xhrError(xhr, ajaxOptions, thrownError) {\n        console.log('error');\n        console.log(xhr);\n        console.log(thrownError);\n      }\n      \n      // called after a successful ajax request \n      \n      xhrResultsHandler(data,textStatus,jqXHR) {\n      \n      }\n      \n      // see DSpace Handler for an extended implementation\n      \n      build_paths() {\n        return {\n          items: {\n            list: {                              // Returns a list of items\n              method: \"GET\",\n              path:     \"[path]\", \n              },                              \n            item: {                               // Returns a single item with ID %%\n              method: \"GET\",\n              path:     \"[path]/%%\"\n              },                           \n            item_metadata: {                      // Returns metadata for item %%\n              method: \"GET\",\n              path:     \"[path]/%%/[key]\",  \n              },       \n            find_by_metadata: {                   // Returns items based on specified metadata value\n              method: \"POST\",\n              path:     \"[path]\"\n            }     \n          },\n          query: {  \n            filtered_items: {                     // Returns items based on chosen filters\n              method: \"GET\",\n              path:     \"[path]\",  \n              },           \n            filtered_collections: {               // Returns collections based on chosen filters\n              method: \"GET\",\n              path:     \"[path]\",\n              }, \n            collection: {                         // Returns collection with ID %%\n              method: \"GET\",\n              path:     \"[path]/%%\",\n              }         \n          }\n        };\n      }\n    }\n    \n    /* !DSPACE HANDLER */\n    \n    class DSpaceDataHandler extends DiscoveryDataHandler {\n      constructor(dbURI, dbmethod) {\n        super(dbURI, dbmethod);\n        this.query = [];\n        this.expansion = []; // expands the dataset\n        this.filters = [];  // adds filters\n        this.fields = []; // fields to show\n      }\n      \n      resetQueryParameters() {\n        this.query = [];\n      }\n  \n      /* Available operators:\n        \n        exists\n        doesnt_exist\n        equals\n        not_equals\n        like\n        not_like\n        contains\n        doesnt_contain\n        matches\n        doesnt_match\n      */\n\n      \n      setQueryParameter(parameter,value,operator='like') {\n        \n        this.query.push({\n          name:   \"query_field[]\",\n          value:  parameter\n        });\n        \n        this.query.push({\n          name:   \"query_op[]\",\n          value:  operator\n        });\n        \n        this.query.push({\n          name:   \"query_val[]\",\n          value:  value\n        });\n        \n        return this;  \n      }\n      \n      // A search term is general across all metadata\n      \n      setSearchTerm(value,operator='contains') {\n        this.setQueryParameter('*',value,operator);\n        return this;\n      }\n      \n      setAdditionalParameter(parameter,value) {\n        this.query.push({\n          name: parameter,\n          value: value\n          });\n        return this;\n      }\n      \n      // Rudimentary. Will be particualar to database implementation. \n      \n      setLimit(limit=100,offset=0) {\n        this\n          .setAdditionalParameter('limit',limit)\n          .setAdditionalParameter('offset',offset);\n        return this;\n      }\n      \n      setCollection(collectionID) {\n        this.setAdditionalParameter('collSel[]',collectionID);\n        return this;\n      }\n      \n      /*  Expands the returned dataset. \n        \n          Some values:\n            metadata\n            bitstreams\n            parentCollection\n            parentCollectionList\n            parentCommunityList\n      */\n            \n      expandQuery(expansion) {\n        this.expansion.push(expansion);\n        this.setAdditionalParameter('expand',this.expansion.join(','));\n        return this;\n      }\n      \n      // Filters the dataset. Exanmples include 'is_withdrawn' or 'is_discoverable'\n      \n      filterQuery(filter) {\n        this.filters.push(filter);\n        this.setAdditionalParameter('expand',this.filters.join(','));\n        return this;\n      }\n      \n      // A shortcut to include metadata in results\n      \n      includeMetaData() {\n        this.expandQuery('metadata');\n        return this;\n      }\n      \n      // A shortcut to include bitstreams in results\n      \n      includeBitstreams() {\n        this.expandQuery('bitstreams');\n        return this;\n      }\n            \n      // Builds DSpace-specific paths\n      // TO DO: Build this into a common schema for all storage devices\n      \n      build_paths() {\n        return {\n          items: {\n            list: {                              // Returns a list of items\n              method: \"GET\",\n              path:     \"items\", \n              },                              \n            item: {                               // Returns a single item with ID %%\n              method: \"GET\",\n              path:     \"items/%%\"\n              },                           \n            item_metadata: {                      // Returns metadata for item %%\n              method: \"GET\",\n              path:     \"items/%%/metadata\",  \n              },       \n            item_bitstreams: {                    // Returns available bitstreams for item %%\n              method: \"GET\",\n              path:     \"items/%%/bitstreams\"  \n              },\n            find_by_metadata: {                   // Returns items based on specified metadata value\n              method: \"POST\",\n              path:     \"items/find-by-metadata-field\"\n            }     \n          },\n          query: {  \n            filtered_items: {                     // Returns items based on chosen filters\n              method: \"GET\",\n              path:     \"filtered-items\",  \n              },           \n            filtered_collections: {               // Returns collections based on chosen filters\n              method: \"GET\",\n              path:     \"filtered-collections\",\n              }, \n            collection: {                         // Returns collection with ID %%\n              method: \"GET\",\n              path:     \"filtered-collections/%%\",\n              }         \n          },\n          bitstreams: { \n            list: {                                // Returns all bitstreams in DSpace\n              method: \"GET\",\n              path:     \"bitsreams\"\n            },\n            item: {                               // Returns an item with bitstream ID %%\n              method: \"GET\",\n              path:     \"bitstreams/{%%}\"\n            },\n            item_policy: {                        // Returns the policy for a bitstream with ID %%\n              method: \"GET\",\n              path:     \"bitstreams/%%/policy\"\n            },\n            content: {                             // Retrieve content for a bitstream with ID %%\n              method:  \"GET\",\n              path:      \"bitstreams/%%/retrieve\"\n            }\n          },\n          schemas: {\n            list: {                        // Returns a list of all schemas\n              method: \"GET\",\n              path:     \"registries/schema\"\n            },\n            item: {                             // Returns a metadata schema with schema prefix %%\n              method: \"GET\",\n              path:     \"registries/schema/%%\"\n            },\n            field: {                              // Returns a metadata schema with field ID %%\n              method: \"GET\",\n              path:     \"registries/metadata-fields/%%\"\n            }\n          }\n        };\n      }\n      \n    }\n    \n    class Discovery {\n      constructor() {\n        // this.controller = new DiscoveryController();\n        // this.view = new DiscoveryView();\n        // this.DataHandler = new DiscoveryDataHandler();\n      }\n    }\n    \n    /* !ECO DISCOVERY CLASS */\n    /*\n      vars expects:\n      \n      {\n        controllerID: '#discovery-interface',\n        viewID:       '#results',\n        dbURI:        'books.spi.ryerson.ca/rest',\n        dbmethod:   'https'\n      }\n      \n    */\n    \n    class ECommonsOntarioDiscovery extends Discovery {\n      constructor(vars) {\n        super();\n        this.controller = new HTMLUIController(vars.controllerID);\n        this.view = new PaginatedHTMLView(vars.viewID);\n        this.data = new DSpaceDataHandler(vars.dbURI, vars.dbmethod);\n        \n      }\n    }\n    \n    \n    /* !DOCUMENT READY */\n    \n    $(document).ready(function() {\n            \n      var discovery = new ECommonsOntarioDiscovery\n        ({\n          controllerID: '#discovery-interface',\n          viewID:       '#results',\n          dbURI:        'books.spi.ryerson.ca/rest',\n          dbmethod:     'https'\n        });\n      \n      var results = discovery.data.setSearchTerm('Electrical').includeMetaData().performQuery().getResults();\n      \n    });\n  \n    \n})(jQuery);\n\n\n\n"],"sourceRoot":"assets/scripts/"}