{"version":3,"sources":["../assets/scripts/find.js"],"names":["$","DiscoveryController","discoveryObj","controller","queue","enqueue","controllerStateChange","CriteriaSelectionController","facets","PaginationController","HTMLPaginationController","paginator","nextbtn","find","prevbtn","pagebtns","pageIndicator","html","currentPageIndicator","totalResultsIndicator","currentRangeIndicator","itemLimit","data","currentPage","initUI","resultsInfo","getResultInfo","nextPage","totalPages","viewPage","prevPage","page","attr","self","console","log","length","unbind","hide","bind","event","preventDefault","submit","show","previousPage","i","append","replaceAll","each","totalResults","start","end","push","op","values","HTMLSearchBox","HTMLCriteriaController","setDefaultState","setAttribute","closest","facet","undefined","initfnc","ucfirst","item","toggleClass","removeAttr","siblings","input","val","keyCode","which","replace","split","DiscoveryView","items","HTMLView","view","stage","titleStage","templates","parseTemplates","twrapper","remove","template","processed","match","forEach","token","key","processTokens","book_capsule","ECommonsOntarioCriteriaController","ECommonsOntarioHTMLView","discoveryObject","DiscoveryDataHandler","dbURI","dbmethod","dburl","paths","build_paths","query","resultsComplete","XHROpts","resetXHROpts","results","expandedResults","parameter","value","operator","Parameter","term","limit","offset","async","method","error","xhrError","Deferred","opt","prepareQuery","setXHROpt","makeURL","filtered_items","path","retrieve","when","done","Math","ceil","parseInt","ajax","extend","success","textStatus","jqXHR","xhrResultsHandler","processResults","resolve","xhr","ajaxOptions","thrownError","list","item_metadata","find_by_metadata","filtered_collections","collection","DSpaceDataHandler","resetQueryParameters","expansion","filters","fields","name","setQueryParameter","updateResultsInfo","uuid","subject","byline","title","metadata","j","md","prop","join","serializeDisplayString","subjects","output","replaceLast","setAdditionalParameter","collectionID","expansionValue","includes","filter","expandQuery","retrieveExpandedResults","url","item_bitstreams","bitstreams","item_policy","content","schemas","field","Discovery","dataOpQueue","controllers","label","resetDataOps","concat","execute","setItemLimit","map","trim","setDataOp","retrieveData","getResults","displayResults","updateControllers","updateController","resetDataParameters","apply","executeQuery","setItems","displayQueryResults","ECommonsOntarioDiscovery","vars","registerController","inboundState","getUrlParameter","decodeURIComponent","criteriaController","reset","includeMetaData","document","ready","discovery","jQuery","String","prototype","charAt","toUpperCase","slice","search","replacement","target","RegExp","index","lastIndexOf","substring","toString","sParam","sPageURL","window","location","sURLVariables","sParameterName"],"mappings":"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","file":"find.js","sourcesContent":["/* jshint latedef:nofunc */\n//needed for function hoisting for build \n\n(function($) {\n  \n    /* !DISCOVERY CONTROLLER CLASS */\n    \n    // Core Controller Class\n    \n    class DiscoveryController {\n      constructor(discoveryObj) {\n        this.discoveryObj = discoveryObj;\n        this.controller = null;\n        this.queue = [];\n      }  \n      \n      // To be called when results return from the data handler. Used to update results-dependent control devices such as paginators.\n      \n      updateController() {\n        \n      }\n      \n      // The controller is responsible for adding Data Class operators and values to the this.queue array, using the following form:\n      // { op: 'dataOpName', value: [list,of,op,arguments] }\n      \n      enqueue() {\n        \n      }\n      \n      // Submit enqueues and activates a controller state change in the main Disocvery object. \n      // If you want to manually retrieive values just enqueue the controller (listing its ops)\n      \n      // Reset should reset the controller to its default options.\n      \n      reset() {\n        \n      }\n            \n      submit() {\n        this.enqueue();\n        this.discoveryObj.controllerStateChange();\n      }\n      \n    }\n    \n    // Manages UIs that submit filter criteria.\n    \n    /* !CRITERIA SELECTION CONTROLLER CLASS */\n    \n    class CriteriaSelectionController extends DiscoveryController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n        this.facets = null;\n      }\n      \n      updateController() {\n        super.updateController();\n      }\n      \n      enqueue() {\n        super.enqueue();\n      }\n      \n      submit() {\n        super.submit();\n      }\n      \n    }\n    \n    /* !PAGINATION CONTROLLER CLASS */\n    // Manages Pagination UIs.\n    \n    class PaginationController extends DiscoveryController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n      }\n      \n      updateController() {\n        super.updateController();\n      }\n      \n      initUI() {\n        \n      }\n      \n      enqueue()  {\n        super.enqueue();\n      }\n      \n      submit() {\n        super.submit();\n      }\n    }\n    \n    /* !HTML PAGINATION CONTROLLER CLASS */\n    \n    // Manages HTML5-Based Pagination UIs\n    class HTMLPaginationController extends PaginationController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n        \n        // Components\n        this.discoveryObj = discoveryObj;\n        this.paginator = $('[data-controller-paginator]');\n        this.nextbtn = this.paginator.find('[data-controller-next]');\n        this.prevbtn = this.paginator.find('[data-controller-previous]');\n        this.pagebtns = this.paginator.find('[data-controller-pagebtns]');\n        this.pageIndicator = this.pagebtns.html();\n        \n        this.currentPageIndicator = this.paginator.find('[data-controller-current-page]');\n        this.totalResultsIndicator = this.paginator.find('[data-controller-total-results]');\n        this.currentRangeIndicator = this.paginator.find('[data-controller-current-range]');\n        \n        // Settings\n        \n        this.itemLimit = this.paginator.data('controller-item-limit');\n        this.currentPage = this.paginator.data('controller-current-page');\n                        \n        this.initUI();\n      }\n      \n      nextPage() {\n        var resultsInfo = this.discoveryObj.data.getResultInfo();\n        var nextPage = (resultsInfo.currentPage + 1) > resultsInfo.totalPages ? 1 : (resultsInfo.currentPage + 1);\n        this.viewPage(nextPage);\n      }\n      \n      previousPage() {\n        var resultsInfo = this.discoveryObj.data.getResultInfo();\n        var prevPage = (resultsInfo.currentPage - 1) === 0 ? resultsInfo.totalPages : (resultsInfo.currentPage - 1);\n        this.viewPage(prevPage);\n      }\n            \n      viewPage(page) {        \n        var resultsInfo = this.discoveryObj.data.getResultInfo();\n        this.paginator.attr('data-controller-current-page',page);\n      }\n      \n      updateController() {\n        this.initUI();\n      }\n      \n      initUI() {\n        super.initUI();\n        \n        var self = this;\n        var resultsInfo = this.discoveryObj.data.getResultInfo();\n        \n        console.log('initUI');\n        console.log('resultsInfo');\n        console.log(resultsInfo);\n                \n        // Resent click event handlers and hide control elements.        \n        \n        if (this.nextbtn.length > 0) {\n          this.nextbtn.unbind('click').hide();\n          \n          this.nextbtn.bind('click',function(event){\n            event.preventDefault();\n            self.nextPage();\n            self.submit();\n          });\n          \n          if (resultsInfo.currentPage < resultsInfo.totalPages) {\n            this.nextbtn.show();\n          } \n        }\n        \n        if(this.prevbtn.length > 0) {\n          this.prevbtn.unbind('click').hide();\n          \n          this.prevbtn.bind('click',function(event){\n            event.preventDefault();\n            self.previousPage();\n            self.submit();\n          });\n          \n          if (resultsInfo.currentPage > 1) {\n            this.prevbtn.show();\n          }   \n        \n        }\n        \n        this.pagebtns.hide();\n        this.pagebtns.html('');\n          \n        if (this.paginator.length > 0) {\n        \n          // Build paginators\n          \n          if (resultsInfo.totalPages > 0) {\n            for (var i=1;i<resultsInfo.totalPages+1;i++) {\n              console.log('appending');\n              this.pagebtns.append(this.pageIndicator.replaceAll('%%',i)); \n            }\n                        \n            this.pagebtns.find('[data-controller-pagebtn]').each(function(){\n              $(this).bind('click',function(event) {\n                event.preventDefault();\n                self.viewPage($(this).attr('data-pageref'));\n                self.submit();\n              });\n            });\n            \n            this.pagebtns.show();\n\n            \n            if (this.currentPageIndicator.length > 0) {\n              this.currentPageIndicator.html(resultsInfo.currentPage);\n            }\n            \n            if (this.totalResultsIndicator.length > 0) {\n              this.totalResultsIndicator.html(resultsInfo.totalResults);\n            }\n            \n            if (this.currentRangeIndicator.length > 0) {\n              var start = ((resultsInfo.currentPage-1) * resultsInfo.itemLimit) + 1;\n              var end = ((resultsInfo.currentPage-1) * resultsInfo.itemLimit) + resultsInfo.itemLimit;\n              end = end > resultsInfo.totalResults ? resultsInfo.totalResults : end;\n              this.currentRangeIndicator.html(start + \" – \" + end);\n            }\n            \n            this.paginator.show();\n          }\n        }        \n      }\n      \n      enqueue() {\n        this.queue = [];\n        this.queue.push(\n          {\n            op: 'setItemLimit',\n            values: [this.paginator.attr('data-controller-item-limit'),this.paginator.attr('data-controller-current-page')]\n          });\n          \n        console.log('pagination queue');\n        console.log(this.queue);\n          \n      }\n      \n      \n    }\n    \n    /* !HTML SEARCH BOX CLASS */\n    // Manages standalone Search Box UIs\n    \n    class HTMLSearchBox extends CriteriaSelectionController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n      }\n    }\n        \n    /* !HTMLUI CONTROLLER */\n        \n    class HTMLCriteriaController extends CriteriaSelectionController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n        this.controller = $(\"[data-widget='discovery-controller']\");\n        this.facets = this.controller.find(\"[data-facet]\");\n        this.setDefaultState();\n        this.initUI();\n      }\n      \n      // Finds any item marked 'data-default-value' and sets it for inclusion in the queue.\n      \n      setDefaultState() {\n        this.controller.find('[data-default-value]').each(function(){\n          $(this)[0].setAttribute('data-selected','');\n          $(this).closest('[data-facet]')[0].setAttribute('data-enqueue','');\n        });\n      }\n      \n      initUI() {\n        var self = this;\n        \n        /* \n           Allows us to define widget initialization methods based on the ui-type.\n           Methods are in the form init[ui-type], with ui-type capitalized.\n           \n           Initialization functions are responsible for the following:\n           - Binding the appropriate change event (e.g. a click for a list or change for a selection). \n           - Adding its parent facet to the query queue by assigning it a 'data-enqueue' attribute.\n           - Adding a 'data-selected' attribute to any selected item.\n           - Resetting the facet if a user selects an “all” or “none” value, indicated in the controller by a '*' data-value.\n           - Firing the controller’s submit method.\n           - Performing any UX event modifications (such as preventing default link behaviour on link lists).\n        */\n        \n        this.facets.each(function() {\n          var facet = $(this);\n          if (typeof facet.data('ui-type') === undefined) { return; }\n          var initfnc = \"init\" + facet.data('ui-type').ucfirst();\n          if (typeof self[initfnc] !== 'function') { return; }\n          self[initfnc](facet);\n        });\n      }\n                  \n      initList(facet) {\n        var self = this;\n        facet.find('[data-user-input-wrapper]').find('li').each(function() {\n          $(this).bind('click',function(event) {\n            event.preventDefault();\n            var item = $(this);\n            item.toggleClass('selected');\n            if (item.data('value') === '*') {\n              facet.removeAttr('data-enqueue');\n              item.siblings('li').removeAttr('data-selected');\n            } else {\n              facet[0].setAttribute('data-enqueue',''); // Use native JS to set boolean attribute\n              item[0].setAttribute('data-selected',''); \n            }\n            self.submit();\n          });\n        });        \n      }\n      \n      initTextfield(facet) {\n        var self = this;\n        facet.find('[data-user-input]').each(function() {\n          $(this).bind('keypress',function(event) {\n            var input = $(this);\n            if(input.val().length > 2) { // Don’t submit if there are less than three characters in the text field\n              facet[0].setAttribute('data-enqueue',''); // Use native JS to set boolean attribute\n              input[0].setAttribute('data-selected','');\n              input.attr('data-value',input.val());\n              self.submit();\n            } else {\n              facet.removeAttr('data-enqueue');\n              input.removeAttr('data-selected');\n            }\n          })\n          .bind('keypress', function(event) { // intercepts return character which would otherwise \"submit\" the form\n            if ((event.keyCode ? event.keyCode : event.which) === 13) {\n              self.submit();\n              return false;\n            } else { \n              return true;\n            }\n          });\n        });\n      }   \n      \n      reset() {\n        this.controller.find('[data-enqueue]').each(function(){\n          $(this).removeAttr('data-enqueue');\n        });\n        \n        this.controller.find('[data-selected]').each(function(){\n          $(this).removeAttr('data-selected');\n        });\n      }\n      \n      /* \n          Adds a list of data retrieval objects to the queue. Data retrieval objects contain a\n          data op (corresponding to a method of the data object) and values corresponding to its\n          arguments.\n      */   \n      \n      enqueue() {\n        var self = this;\n        this.queue = [];\n        this.controller.find('[data-enqueue]').each(function() {\n          var facet = $(this);\n          var values = [];\n          facet.find('[data-selected]').each(function() {\n            self.queue.push(\n              {\n                op: facet.data('op'),\n                values: facet.data('param').replace('%%',$(this).attr('data-value')).split('|')\n              }\n            );\n          });\n          \n        });\n      }\n      \n      submit() {\n        super.submit();\n      }\n      \n      \n    }\n    \n    /* !DISCOVERY VIEW CLASS */\n    \n    class DiscoveryView {\n      contructor(discoveryObj) {\n        this.items = [];\n      }\n      \n      setItems(items) {\n        this.items = items;\n        return this;\n      }\n            \n      displayQueryResults() {\n\n      }\n    }\n    \n    \n    /* !HTML VIEW CLASS */\n    \n    \n    // Displays results on HTML5 Stage\n    \n    class HTMLView extends DiscoveryView {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n        this.view = $('[data-view-results]');\n        this.stage = this.view.find('[data-view-stage]');\n        this.titleStage = this.view.find('[data-view-title-stage]');\n        this.templates = {};\n        this.parseTemplates();        \n      }\n      \n      // Finds templates in the DOM and adds them to the templates object.\n      // Templates are designated in the DOM by a [data-view-template-wrapper] boolean attribute.\n      // This script expects that each wrapper have [data-template-name], which will be used as\n      // an object property. The template block is then removed from the DOM.\n      \n      parseTemplates() {\n        var self = this;\n        var templates = this.view.find('[data-view-templates]');\n        templates.find('[data-view-template-wrapper]').each(function(){\n          var twrapper = $(this);\n          self.templates[twrapper.data('view-template-name')] = twrapper.html();\n        })\n        .remove();\n      }\n      \n      // Tokens are processed as follows:  \n      // %%DataKey%%\n      \n      processTokens(template,item) {\n        var processed = template;\n        template.match(/\\%\\%[^\\%]*\\%\\%/g).forEach(function(token) {\n          var key = token.replaceAll('%%','');\n          processed = processed.replaceAll(token,item.values[key]);\n        });\n        \n        return processed;\n      }\n      \n      displayQueryResults() {\n        var self = this;\n        self.stage.html('');\n        this.items.forEach(function(item) {\n          self.stage.append(self.processTokens(self.templates.book_capsule,item));\n        });\n      }\n    }\n    \n    // Displays controller particular to the ECommonsOntario site\n    \n    class ECommonsOntarioCriteriaController extends HTMLCriteriaController {\n      constructor(discoveryObj) {\n        super(discoveryObj);\n      }\n    }\n    \n    // Displays results particular to the ECommonsOntario site\n    \n    class ECommonsOntarioHTMLView extends HTMLView {\n      constructor(discoveryObject) {\n        super(discoveryObject);\n      }\n    }\n        \n    /* !DISCOVERY DATA HANDLER */\n    \n    class DiscoveryDataHandler {\n      constructor(dbURI, dbmethod) {\n        this.dburl = dbmethod + '://' + dbURI;\n        \n        this.paths = this.build_paths();\n        this.query = {};\n        this.resultsComplete = null;\n        this.XHROpts = this.resetXHROpts();\n        this.results = {};\n        this.itemLimit = 6;\n        this.currentPage = 0;\n        this.totalResults = 0;\n        this.totalPages = 0;\n        \n        this.expandedResults = {}; // results without limits\n      }\n            \n      resetQueryParameters() {\n        this.query = {};\n      }\n  \n      // Placeholder. Will be particualar to database implementation. \n      \n      setQueryParameter(parameter,value,operator='like') {\n        this.query[Parameter] = value;\n        return this;  \n      }\n      \n      // Placeholder. Will be particular to database implementation\n      \n      setSearchTerm(term,operator='matches') {\n        return this;\n      }      \n      // Placeholder. Will be particular to database implementation\n      \n      setDateIssed(value,operator='<') {\n        return this;\n      }\n      \n      // Placeholder. Will be particualar to database implementation. \n      \n      setItemLimit(limit,page) {\n        var offset = limit * (page - 1);\n        this.itemLimit = limit;\n        this.currentPage = page;\n        return this;\n      }      \n      \n      // A wrapper for the query Parameter\n      \n      getQuery() {\n        return this.query;\n      }\n      \n      // Sets default options for the AJAX call.\n      \n      resetXHROpts() {\n        this.XHROpts = {\n          async: true,\n          method: \"GET\", // default\n          //traditional: true,\n          //crossOrigin: true,\n          error: this.xhrError,\n        };\n        \n        this.resultsComplete= $.Deferred();\n      }\n      \n      // Set AJAX option as per http://api.jquery.com/jquery.ajax/\n      \n      setXHROpt(opt,value) {\n        this.XHROpts[opt] = value;\n        return this;\n      }\n      \n      // Wrapper that returns AJAX options\n      \n      getXHROpts() {\n        return this.XHROpts;\n      }\n      \n      // Performs filtered query\n      \n      executeQuery() {\n        this.resetXHROpts();\n        this.prepareQuery();\n        this\n          .setXHROpt('url',this.makeURL(this.paths.query.filtered_items.path))\n          .setXHROpt('method',this.paths.query.filtered_items.method)\n          .setXHROpt('data',this.query);  \n        console.log('xhr');\n        console.log(this.XHROpts);\n        this.retrieve(); \n        return this;     \n      }\n      \n      processResults() {\n        var self = this;\n        $.when(this.resultsComplete).done(function() {\n          \n        });\n      }\n      \n      // To be called after results are processed. Each data class must return a total result count outside of filter limits.\n      \n      updateResultsInfo(totalResults) {\n        console.log('update total results');\n        this.totalResults = totalResults;\n        this.totalPages = Math.ceil(this.totalResults / this.itemLimit);\n      }\n      \n      // Returns a handy object with result resultsInfo. Useful for updating pagination controllers.\n      \n      getResultInfo() {\n        return {\n          itemLimit: parseInt(this.itemLimit),\n          totalResults: parseInt(this.totalResults),\n          currentPage: parseInt(this.currentPage),\n          totalPages: parseInt(this.totalPages)\n        };\n      }\n      \n      // A shortcut to the results. Can only be called when this.resultsComplete is resolved.\n      \n      getResults() {\n        return this.results;\n      }\n      \n      makeURL(path) {\n        return this.dburl + \"/\" + path;\n      }\n            \n      // Retrieves data from storage. On success it calls an xhrResultsHandler (which is passed data directly)\n      // and a processResults (which is handed no arguments and is intended to operate on this.results)\n                      \n      retrieve() {\n        var self = this;\n        $.ajax($.extend(this.XHROpts,\n          {\n            success: \n              function(data,textStatus,jqXHR) { \n                self.results = data; \n                self.xhrResultsHandler(data,textStatus,jqXHR,self);\n                self.processResults();\n                self.resultsComplete.resolve(); \n              },\n          }\n        ));\n      }\n      \n      \n      // Handles XHR Errors. This function must be explicity set as part of the $.ajax() parameters.\n      \n      xhrError(xhr, ajaxOptions, thrownError) {\n        console.log('error');\n        console.log(xhr);\n        console.log(thrownError);\n      }\n      \n      // called after a successful ajax request \n      // marks resultsComplete as resolve.\n      \n      xhrResultsHandler(data,textStatus,jqXHR,self) {\n      \n      }\n      \n      // see DSpace Handler for an extended implementation\n      \n      build_paths() {\n        return {\n          items: {\n            list: {                              // Returns a list of items\n              method: \"GET\",\n              path:     \"[path]\", \n              },                              \n            item: {                               // Returns a single item with ID %%\n              method: \"GET\",\n              path:     \"[path]/%%\"\n              },                           \n            item_metadata: {                      // Returns metadata for item %%\n              method: \"GET\",\n              path:     \"[path]/%%/[key]\",  \n              },       \n            find_by_metadata: {                   // Returns items based on specified metadata value\n              method: \"POST\",\n              path:     \"[path]\"\n            }     \n          },\n          query: {  \n            filtered_items: {                     // Returns items based on chosen filters\n              method: \"GET\",\n              path:     \"[path]\",  \n              },           \n            filtered_collections: {               // Returns collections based on chosen filters\n              method: \"GET\",\n              path:     \"[path]\",\n              }, \n            collection: {                         // Returns collection with ID %%\n              method: \"GET\",\n              path:     \"[path]/%%\",\n              }         \n          }\n        };\n      }\n    }\n    \n    /* !DSPACE DATA HANDLER */\n    \n    class DSpaceDataHandler extends DiscoveryDataHandler {\n      constructor(dbURI, dbmethod) {\n        super(dbURI, dbmethod);\n        this.resetQueryParameters();\n      }\n      \n      resetQueryParameters() {\n        this.query = [];\n        this.expansion = []; // expands the dataset\n        this.filters = [];  // adds filters\n        this.fields = []; // fields to show\n      }\n  \n      /* \n        \n        Available operators:\n        \n        exists\n        doesnt_exist\n        equals\n        not_equals\n        like\n        not_like\n        contains\n        doesnt_contain\n        matches\n        doesnt_match\n    \n      */\n\n      setQueryParameter(parameter,value,operator='like') {\n        \n        this.query.push({\n          name:   \"query_field[]\",\n          value:  parameter\n        });\n        \n        this.query.push({\n          name:   \"query_op[]\",\n          value:  operator\n        });\n        \n        this.query.push({\n          name:   \"query_val[]\",\n          value:  value\n        });\n        \n        return this;  \n      }\n      \n      // Handles any special processing\n      \n      prepareQuery() {\n\n      }\n      \n      // A search term is general across all metadata\n      // Note: the “matches” operator alongside framing wildcards (“*value*”) returns a general case-insensitive result.\n      \n      setSearchTerm(value,operator='matches') {\n        this.setQueryParameter('*','(?i).*' + value + '*',operator);\n        return this;\n      }\n      \n      // called after a successful ajax request \n      \n      xhrResultsHandler(data,textStatus,jqXHR) {\n        super.xhrResultsHandler(data,textStatus,jqXHR);\n        if (typeof this.results.items === 'undefined') {\n          this.results.items = [];\n        }\n      }\n      \n      processResults() {\n        super.processResults();\n        var self = this;\n                \n        if (typeof self.expandedResults['unfiltered-item-count'] !== \"undefined\") {\n          self.updateResultsInfo(self.expandedResults['unfiltered-item-count']);\n        }\n        \n        for(var i=0; i<self.results.items.length; i++) {\n          var item = self.results.items[i];\n          \n          // Set default values.\n                  \n          var values = {\n            uuid: item.uuid,\n            subject: '',\n            byline: '',\n            title: ''\n          };\n          \n          if (typeof item.metadata !== \"undefined\") {\n            for(var j=0; j<item.metadata.length; j++) {\n              var md = item.metadata[j];\n              var key = md.key;\n              if (typeof values[key] === \"undefined\") {\n                values[key] = [];\n              }\n              values[key].push(md.value);\n            }\n          }\n          \n          // Join multiple values as single string\n          \n          for(var prop in values) {\n            if (values[prop] === \"undefined\" || typeof values[prop] !== 'object') {\n              values[prop] = '';\n            } else {\n              values[prop] = values[prop].join('%%');\n            }\n          }\n                      \n          // Process contributors\n          values.byline = self.serializeDisplayString(values,'dc.contributor.author');\n          values.subjects = self.serializeDisplayString(values,'dc.subject');\n          \n          self.results.items[i].values = values;\n        }\n      }\n      \n      serializeDisplayString(values,key) {\n        var output = '';\n        \n        if (typeof values[key] !== \"undefined\") {\n          output = values[key].replaceAll('%%',', ');\n          output = output.replaceLast(',',' and');\n        }\n        \n        return output;\n      }\n      \n      setAdditionalParameter(parameter,value) {\n        this.query.push({\n          name: parameter,\n          value: value\n          });\n        return this;\n      }\n      \n      // TO DO\n      \n      setDateIssed(term,operator='<') {\n        return this;\n      }\n            \n      setItemLimit(limit=6,page=1) {\n        super.setItemLimit(limit,page);\n        var offset= limit * (page - 1);\n        this\n          .setAdditionalParameter('limit',limit)\n          .setAdditionalParameter('offset',offset);\n        return this;\n      }\n      \n      setCollection(collectionID) {\n        this.setAdditionalParameter('collSel[]',collectionID);\n        return this;\n      }\n      \n      /*  Expands the returned dataset. \n        \n          Some values:\n            metadata\n            bitstreams\n            parentCollection\n            parentCollectionList\n            parentCommunityList\n      */\n            \n      expandQuery(expansionValue) {\n        if (this.expansion.includes(expansionValue) === false) {\n          this.expansion.push(expansionValue);\n          this.setAdditionalParameter('expand',this.expansion.join(','));\n        }\n        return this;\n      }\n      \n      // Filters the dataset. Exanmples include 'is_withdrawn' or 'is_discoverable'\n      \n      filterQuery(filter) {\n        this.filters.push(filter);\n        this.setAdditionalParameter('expand',this.filters.join(','));\n        return this;\n      }\n      \n      // A shortcut to include metadata in results\n      \n      includeMetaData() {\n        this.expandQuery('metadata');\n        return this;\n      }\n      \n      // A shortcut to include bitstreams in results\n      \n      includeBitstreams() {\n        this.expandQuery('bitstreams');\n        return this;\n      }\n      \n      /* ! -- AJAX call */\n      // See “HACK” below for explanation. Need to eliminate this.\n      \n      retrieve() {\n        var self = this;\n        $.ajax($.extend(this.XHROpts,\n          {\n            success: \n              function(data,textStatus,jqXHR) { \n                self.results = data; \n                self.xhrResultsHandler(data,textStatus,jqXHR,self);\n                self.retrieveExpandedResults();\n              },\n          }\n        ));\n      }\n      \n      // HACK: Can't seem to find a way to retrieve both a paginated result and the total number of results without pagination.\n      // This total value is required to set up a proper pagination UI.\n      // One option would be to retrieve all results unpaginated and parse them on the client side. \n      // As of now we're querying twice to get the number of unfiltered items.\n      \n      retrieveExpandedResults() {\n        var self = this;\n                        \n        $.ajax({\n            method: \"GET\",\n            async: true,\n            url: this.makeURL(this.paths.query.filtered_items.path),\n            data: this.query.filter(function(item){\n              return (item.name === 'limit' || item.name === 'offset') !== true;\n            }),\n            success: \n              function(data,textStatus,jqXHR) { \n                self.expandedResults = data;\n                self.processResults();\n                self.resultsComplete.resolve(); \n              }\n            });\n      }\n\n            \n      // Builds DSpace-specific paths\n      // TO DO: Build this into a common schema for all storage devices\n      \n      build_paths() {\n        return {\n          items: {\n            list: {                              // Returns a list of items\n              method: \"GET\",\n              path:     \"items\", \n              },                              \n            item: {                               // Returns a single item with ID %%\n              method: \"GET\",\n              path:     \"items/%%\"\n              },                           \n            item_metadata: {                      // Returns metadata for item %%\n              method: \"GET\",\n              path:     \"items/%%/metadata\",  \n              },       \n            item_bitstreams: {                    // Returns available bitstreams for item %%\n              method: \"GET\",\n              path:     \"items/%%/bitstreams\"  \n              },\n            find_by_metadata: {                   // Returns items based on specified metadata value\n              method: \"POST\",\n              path:     \"items/find-by-metadata-field\"\n            }     \n          },\n          query: {  \n            filtered_items: {                     // Returns items based on chosen filters\n              method: \"GET\",\n              path:     \"filtered-items\",  \n              },           \n            filtered_collections: {               // Returns collections based on chosen filters\n              method: \"GET\",\n              path:     \"filtered-collections\",\n              }, \n            collection: {                         // Returns collection with ID %%\n              method: \"GET\",\n              path:     \"filtered-collections/%%\",\n              }         \n          },\n          bitstreams: { \n            list: {                               // Returns all bitstreams in DSpace\n              method: \"GET\",\n              path:     \"bitsreams\"\n            },\n            item: {                               // Returns an item with bitstream ID %%\n              method: \"GET\",\n              path:     \"bitstreams/{%%}\"\n            },\n            item_policy: {                        // Returns the policy for a bitstream with ID %%\n              method: \"GET\",\n              path:     \"bitstreams/%%/policy\"\n            },\n            content: {                             // Retrieve content for a bitstream with ID %%\n              method:  \"GET\",\n              path:      \"bitstreams/%%/retrieve\"\n            }\n          },\n          schemas: {\n            list: {                               // Returns a list of all schemas\n              method: \"GET\",\n              path:     \"registries/schema\"\n            },\n            item: {                               // Returns a metadata schema with schema prefix %%\n              method: \"GET\",\n              path:     \"registries/schema/%%\"\n            },\n            field: {                              // Returns a metadata schema with field ID %%\n              method: \"GET\",\n              path:     \"registries/metadata-fields/%%\"\n            }\n          }\n        };\n      }\n      \n    }\n    \n    /* !DISCOVERY CLASS */\n    \n    class Discovery {\n      constructor() {\n        this.dataOpQueue = [];\n        this.results = {};\n        this.items = [];\n        this.view = {};\n        this.controllers = {};\n\n        \n        /* Example:\n          this.view = new ECommonsOntarioHTMLView(this);\n          this.data = new DSpaceDataHandler(vars.dbURI, vars.dbmethod);\n        */\n      }\n      \n      registerController(label,controller) {\n        this.controllers[label] = controller;\n      }\n      \n      inboundState() {\n        \n      }\n            \n      // fired by Controller when it changes state.\n      // All controllers current op queues are reassembled.\n      \n      controllerStateChange() {\n        \n        this.resetDataOps();\n        \n        for (var controller in this.controllers) {\n          if (this.controllers[controller].queue.length > 0) {\n            this.dataOpQueue = this.dataOpQueue.concat(this.controllers[controller].queue);\n          }\n        }\n                        \n        this.execute();\n      }\n      \n      setItemLimit(limit,page) {\n        this.data.setItemLimit(limit,page);\n      }\n      \n      resetDataOps() {\n        this.dataOpQueue = [];\n      }\n            \n      setDataOp(op,values) {\n\n        // remove spaces from values\n                \n        values = values.map(function(val){\n          val = val.trim();\n          return val;\n        });\n        \n        this.dataOpQueue.push({\n          op: op,\n          values: values\n        });\n      }\n      \n      quickSearch(term) {\n        this.dataOpQueue = [];\n        this.setDataOp('setSearchTerm',[term]);\n        this.execute();\n      }\n            \n      // Clears data parameters\n      \n      resetDataParameters() {\n        this.data.resetQueryParameters();\n      }\n      \n      // retrieves and displays data\n      \n      execute() {\n        var self = this;\n        self.retrieveData();\n        $.when(this.data.resultsComplete).done(function(){\n          self.results = self.data.getResults();\n          self.items = typeof self.results.items !== \"undefined\" ? self.results.items : [];\n          self.displayResults();\n          self.updateControllers();\n          \n        });\n      }\n      \n      // Updates all registered controllers\n      \n      updateControllers() {\n        for(var controller in this.controllers) {\n          this.controllers[controller].updateController();\n        } \n      }\n      \n      // An Alias for reset Data Parameters\n      \n      newQuery() {\n         this.resetDataParameters();\n      }\n      \n      /* !-- Retrieve Data */\n\n      retrieveData() {\n        var self = this;\n        this.resetDataParameters();\n        this.dataOpQueue.forEach(function(item){\n          self.data[item.op].apply(self.data,item.values);\n        });\n        self.data.executeQuery();\n        return this;\n      }      \n      \n      // This function can only be called when this.data.resultsComplete has been resolved.\n      \n      displayResults() {\n        this.view\n          .setItems(this.items)\n          .displayQueryResults();\n      }\n    }\n    \n    /* !ECO DISCOVERY CLASS */\n    /*\n      vars expects:\n      \n      {\n        dbURI:      'books.spi.ryerson.ca/rest',\n        dbmethod:   'https'\n      }\n      \n    */\n    \n    class ECommonsOntarioDiscovery extends Discovery {\n      constructor(vars) {\n        super();\n        this.data = new DSpaceDataHandler(vars.dbURI, vars.dbmethod);\n        this.view = new ECommonsOntarioHTMLView(this);\n        \n        // TO DO: There could be auto-discovery here\n        \n        this.registerController('criteriaController',new ECommonsOntarioCriteriaController(this));\n        this.registerController('paginationController', new HTMLPaginationController(this));\n        \n        this.inboundState();\n      }\n      \n      /* !--Initial State of Application */\n      \n      // Right now only accepts search parameters\n      \n      inboundState() {\n        var op = getUrlParameter('op');\n        var value = decodeURIComponent(getUrlParameter('value'));\n  \n        if (op === 'setSearchTerm') {\n          this.controller.criteriaController.reset();\n          $('#search-value').val(value);\n        }\n        \n        \n        for(var controller in this.controllers) {\n          console.log('calling controller: ' + controller);\n\n          this.controllers[controller].enqueue();\n        }\n        \n        // Executes the initial state of the controllers.\n        \n        this.controllerStateChange();\n        \n      }\n      \n      setItemLimit(limit,page) {\n        super.setItemLimit(limit,page);\n      }\n      \n      resetDataParameters() {\n        super.resetDataParameters();\n        this.data.includeMetaData();\n      }\n      \n    }\n    \n    /* !DOCUMENT READY */\n    \n    $(document).ready(function() {\n            \n      var discovery = new ECommonsOntarioDiscovery\n        ({\n          dbURI:        'dsweb.semiprodint.ryerson.ca/rest',\n          dbmethod:     'http'\n        });\n      \n      // var results = discovery.data.setSearchTerm('Electrical').includeMetaData().executeQuery().getResults();\n      \n    });\n  \n})(jQuery);\n\n// Functions like PHP’s ucfirst()\n\nString.prototype.ucfirst = function() {\n  return this.charAt(0).toUpperCase() + this.slice(1);\n};\n\n// Replaces all instances of a string\n\nString.prototype.replaceAll = function(search, replacement) {\n  var target = this;\n  return target.replace(new RegExp(search, 'g'), replacement);\n};\n\nString.prototype.replaceLast = function(find, replace) {\n  var index = this.lastIndexOf(find);\n\n  if (index >= 0) {\n      return this.substring(0, index) + replace + this.substring(index + find.length);\n  }\n\n  return this.toString();\n};\n\n// With thanks to http://www.jquerybyexample.net/2012/06/get-url-parameters-using-jquery.html\n\nfunction getUrlParameter (sParam) {\n    var sPageURL = decodeURIComponent(window.location.search.substring(1)),\n    sURLVariables = sPageURL.split('&'),\n    sParameterName,\n    i;\n\n  for (i = 0; i < sURLVariables.length; i++) {\n    sParameterName = sURLVariables[i].split('=');\n\n    if (sParameterName[0] === sParam) {\n        return sParameterName[1] === undefined ? true : sParameterName[1];\n    }\n  }\n}\n\n\n"],"sourceRoot":"assets/scripts/"}